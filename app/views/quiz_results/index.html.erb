<h1>Listing Quizzes Taken</h1>

<table style="margin: 0 auto">
  <tr>
    <th>Score</th>
    <th>Survey Name</th>
    <th>Date Taken</th>
    <th></th>
    <th></th>
  </tr>

<% @quiz_results.each do |quiz_result| %> 
  <% @the_results = JSON.parse(quiz_result.result, :symbolize_names => true) %>
  <tr>

    <% score = 0 %>
    <% @the_results.each do |result| %>
      <% if result[:weight] != nil %>
        <% score = score + result[:weight] %>
      <% end %>
    <% end %>
    <td style="width: 50px;"><% if Quiz.find(quiz_result.quiz_id).scoreable == true %><%= score %><% else %>n/a<% end %></td>
    <td style="width: 250px;"><%= Quiz.find(quiz_result.quiz_id).name %></td>
    <td style="width: 150px;"><%= quiz_result.created_at.strftime("%b %e, %Y") %></td>
    <td><%= link_to 'Show', quiz_result %></td>
    <% if can? :destroy, QuizResult %>
      <td><%= link_to 'Destroy', quiz_result, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    <% end %>
  </tr>
<% end %>
</table>

